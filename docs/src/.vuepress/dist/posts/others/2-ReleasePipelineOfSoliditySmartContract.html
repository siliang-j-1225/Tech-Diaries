<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How to create release a pipeline of solidity smart contracts | Siliang&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.42ce39fe.css" as="style"><link rel="preload" href="/assets/js/app.b36afd9e.js" as="script"><link rel="preload" href="/assets/js/2.0fb0043e.js" as="script"><link rel="preload" href="/assets/js/15.2e1fdd18.js" as="script"><link rel="preload" href="/assets/js/8.04925a1c.js" as="script"><link rel="prefetch" href="/assets/js/10.b53a7c73.js"><link rel="prefetch" href="/assets/js/11.8bbe1c23.js"><link rel="prefetch" href="/assets/js/12.ed864ad5.js"><link rel="prefetch" href="/assets/js/13.b4c2ada5.js"><link rel="prefetch" href="/assets/js/14.7e2558dd.js"><link rel="prefetch" href="/assets/js/16.fd0fb4e0.js"><link rel="prefetch" href="/assets/js/3.0649e38c.js"><link rel="prefetch" href="/assets/js/4.1fae39d5.js"><link rel="prefetch" href="/assets/js/5.8c3ed27a.js"><link rel="prefetch" href="/assets/js/6.4ea10b80.js"><link rel="prefetch" href="/assets/js/7.0da1901e.js"><link rel="prefetch" href="/assets/js/9.6aa41a0c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.42ce39fe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Siliang's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">
  All Posts
</a></div><div class="nav-item"><a href="/posts/azure/" class="nav-link">
  Azure
</a></div><div class="nav-item"><a href="/posts/others/" class="nav-link router-link-active">
  Others
</a></div><div class="nav-item"><a href="https://github.com/siliang-jiao/Tech-Diaries" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github Repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">
  All Posts
</a></div><div class="nav-item"><a href="/posts/azure/" class="nav-link">
  Azure
</a></div><div class="nav-item"><a href="/posts/others/" class="nav-link router-link-active">
  Others
</a></div><div class="nav-item"><a href="https://github.com/siliang-jiao/Tech-Diaries" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github Repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/posts/others/" aria-current="page" class="sidebar-link">Indexes</a></li><li><a href="/posts/others/1-WPFvsUWP.html" class="sidebar-link">WPF vs UWP</a></li><li><a href="/posts/others/2-ReleasePipelineOfSoliditySmartContract.html" aria-current="page" class="active sidebar-link">How to create release a pipeline of solidity smart contracts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/posts/others/2-ReleasePipelineOfSoliditySmartContract.html#step-1-install-npm" class="sidebar-link">Step 1 install npm</a></li><li class="sidebar-sub-header"><a href="/posts/others/2-ReleasePipelineOfSoliditySmartContract.html#step-2-install-jq" class="sidebar-link">Step 2 install jq</a></li><li class="sidebar-sub-header"><a href="/posts/others/2-ReleasePipelineOfSoliditySmartContract.html#step-3-compile" class="sidebar-link">Step 3 compile</a></li><li class="sidebar-sub-header"><a href="/posts/others/2-ReleasePipelineOfSoliditySmartContract.html#step-4-migrate" class="sidebar-link">Step 4 migrate</a></li><li class="sidebar-sub-header"><a href="/posts/others/2-ReleasePipelineOfSoliditySmartContract.html#steps-5-update-azure-resources" class="sidebar-link">Steps 5 update Azure resources</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-to-create-release-a-pipeline-of-solidity-smart-contracts"><a href="#how-to-create-release-a-pipeline-of-solidity-smart-contracts" class="header-anchor">#</a> How to create release a pipeline of solidity smart contracts</h1> <p><em>2019/05</em></p> <p>This is an example of how to create an Azure DevOps release pipeline to deploy solidity smart contracts to WestLake, and using the new contract information to update Azure resources.</p> <p>One of the problems for creating a pipeline for smart contracts is, the address of the contracts get updated every time after migrating. Thus if you have cloud resources based on the address information, those resources will need to be updated too.</p> <p>In this example, we use Truffle to compile and migrate smart contracts and tool <code>jq</code> to analysis json.</p> <h2 id="step-1-install-npm"><a href="#step-1-install-npm" class="header-anchor">#</a> Step 1 install npm</h2> <p>Using the built-in plugs of Azure DevOps Pipelines to install npm, or run the following bash command:</p> <blockquote><p><code>npm install</code></p></blockquote> <h2 id="step-2-install-jq"><a href="#step-2-install-jq" class="header-anchor">#</a> Step 2 install jq</h2> <p>Run the following bash command:</p> <blockquote><p><code>sudo apt install jq</code></p></blockquote> <p><em>Find more about <a href="https://stedolan.github.io/jq/" target="_blank" rel="noopener noreferrer">jq, command-line JSON processor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</em></p> <h2 id="step-3-compile"><a href="#step-3-compile" class="header-anchor">#</a> Step 3 compile</h2> <p>Compile smart contracts with Truffle.</p> <p>Run the following bash command:</p> <blockquote><p><code>npx truffle version</code><br> <code>npx truffle compile</code></p></blockquote> <p><em>Find more about <a href="https://www.trufflesuite.com/" target="_blank" rel="noopener noreferrer">Truffle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</em></p> <h2 id="step-4-migrate"><a href="#step-4-migrate" class="header-anchor">#</a> Step 4 migrate</h2> <p>Run the following bash command:</p> <blockquote><p><code>npx truffle migrate --reset --network westlake</code></p></blockquote> <h2 id="steps-5-update-azure-resources"><a href="#steps-5-update-azure-resources" class="header-anchor">#</a> Steps 5 update Azure resources</h2> <p>After compilation and migration, the contracts in format of json file will be updated. That's why we install <code>jq</code> in step 3, thus we can analysis the json file and get the updated information (like address of contracts).</p> <p>Bash code example of obtaining address:</p> <blockquote><p><code>addr=&quot;$(jq '.networks.&quot;NETWORK_ID&quot;.address' ../build/contracts/CONTRACT_NAME.json)&quot;</code></p></blockquote> <p><em>Find the complete example of how to update Logic Apps with the above sample codes <a href="https://github.com/siliang-jiao/Tech-Diaries/tree/master/examples/solidity-deploy" target="_blank" rel="noopener noreferrer">update-logic-app.sh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</em></p> <p><a href="https://github.com/siliang-jiao/Tech-Diaries/issues/3">Leave a comment</a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/13/2021, 6:09:44 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/posts/others/1-WPFvsUWP.html" class="prev">
        WPF vs UWP
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b36afd9e.js" defer></script><script src="/assets/js/2.0fb0043e.js" defer></script><script src="/assets/js/15.2e1fdd18.js" defer></script><script src="/assets/js/8.04925a1c.js" defer></script>
  </body>
</html>
